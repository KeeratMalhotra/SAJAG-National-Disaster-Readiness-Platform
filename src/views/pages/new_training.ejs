<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= pageTitle %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/learn-redesign.css" /> 
    <link rel="stylesheet" href="/css/sidebar.css" />
</head>
<body class="bg-light">

    <%- include('../partials/_sidebar') %>

    <div class="container mt-4">
        
        <div class="card w-75 mx-auto">
            <div class="card-header">
                <h2>Create New Training Program</h2>
            </div>
            <div class="card-body">
                <form id="newTrainingForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">Training Title</label>
                        <input type="text" class="form-control" id="title" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label for="theme" class="form-label">Training Theme</label>
                        <select class="form-select" id="theme" name="theme" required>
                            <option value="Earthquake">Earthquake</option>
                            <option value="Flood">Flood</option>
                            <option value="Cyclone">Cyclone</option>
                            <option value="Landslide">Landslide</option>
                            <option value="Fire Safety">Fire Safety</option>
                            <option value="CBRN">CBRN (Chemical, Biological, Radiological, Nuclear)</option>
                        </select>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startDate" name="startDate" required>
                        </div>
                        <div class="col">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="endDate" name="endDate" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="location" class="form-label">Full Training Address</label>
                        <input type="text" class="form-control" id="location" name="location" required>
                    </div>
                    <div class="row mb-3 g-2 align-items-end">
                        <div class="col">
                            <label for="latitude" class="form-label">Latitude (Optional)</label>
                            <input type="number" step="any" class="form-control" id="latitude" name="latitude" placeholder="e.g., 28.6139">
                        </div>
                        <div class="col">
                            <label for="longitude" class="form-label">Longitude (Optional)</label>
                            <input type="number" step="any" class="form-control" id="longitude" name="longitude" placeholder="e.g., 77.2090">
                        </div>
                        <div class="col-auto">
                            <button type="button" class="btn btn-outline-secondary" id="getLocationBtn" title="Get Current Location">
                                <i class="bi bi-geo-alt"></i> Get Location
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Training Program</button>
                    <a href="/dashboard" class="btn btn-secondary">Cancel</a>
                </form>
            </div>
        </div>

        <div class="card w-75 mx-auto mt-5 mb-5">
            <div class="card-header bg-dark text-white">
                <h4 class="mb-0">Bulk Import Trainings (CSV)</h4>
            </div>
            <div class="card-body">
     
                <div id="import-message"></div>
                
                <form id="importForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="csvFile" class="form-label">Upload CSV File</label>
     
                        <input class="form-control" type="file" id="csvFile" name="trainingsCsv" accept=".csv" required>
                        <div class="form-text">
                            Required columns: <strong>title, theme, startDate, endDate, location, creator_email</strong>.
                            <br>
                            <a href="/trainings_template.csv" download class="text-primary">Download Sample Template</a>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-warning fw-bold">
                        <i class="bi bi-upload"></i> Upload & Import
                    </button>
                </form>
            </div>
        </div>
        </div>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            
            // Get today's date in YYYY-MM-DD format
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const minDate = `${year}-${month}-${day}`;
            
            // Set minimum date to today
            startDateInput.setAttribute('min', minDate);
            endDateInput.setAttribute('min', minDate);

            // Optional: When start date changes, ensure end date is not before it
            startDateInput.addEventListener('change', function() {
                endDateInput.setAttribute('min', this.value);
            });
        });
    </script>

    <script src="/js/training.js"></script>
 
    <script src="/js/import.js"></script> </body>
</html>