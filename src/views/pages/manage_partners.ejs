<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= pageTitle %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/manage_partners.css"> </head>
<body>
    <%- include('../partials/_sidebar') %>

    <main class="main-content">
        <header class="page-header">
            <h1>Manage Partners</h1>
        </header>

        <nav class="nav nav-tabs" id="partnerTabs" role="tablist">
            <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">
                Pending Approvals 
                <% if (pendingPartners.length > 0) { %>
                    <span class="badge rounded-pill bg-warning text-dark"><%= pendingPartners.length %></span>
                <% } %>
            </button>
            <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab">Approved</button>
            <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button" role="tab">Rejected</button>
        </nav>

        <div class="tab-content" id="partnerTabsContent">
            <div class="tab-pane fade show active" id="pending" role="tabpanel">
                 <div class="card mt-3">
                    <div class="card-body">
                        <% if (pendingPartners.length > 0) { %>
                            <div class="partner-list" id="pending-list-container">
                                <% pendingPartners.forEach(partner => { %>
                                    <div class="partner-card" id="user-row-<%= partner.id %>">
                                        <div class="partner-avatar"><span><%= partner.name.charAt(0) %></span></div>
                                        <div class="partner-info">
                                            <div class="partner-name"><%= partner.name %></div>
                                            <div class="partner-org text-muted"><%= partner.organization_name %> &bull; <%= partner.state %></div>
                                        </div>
                                        <div class="partner-actions">
                                            <a href="/api/admin/documents/<%= partner.document_url.split('/')[2] %>" class="btn btn-sm btn-outline-secondary">
    <i class="bi bi-file-earmark-text"></i> View Document
</a>
                                            <button class="btn btn-sm btn-success update-status-btn" data-userid="<%= partner.id %>" data-status="active"><i class="bi bi-check-lg"></i> Approve</button>
                                            <button class="btn btn-sm btn-danger update-status-btn" data-userid="<%= partner.id %>" data-status="rejected"><i class="bi bi-x-lg"></i> Reject</button>
                                        </div>
                                    </div>
                                <% }) %>
                            </div>
                        <% } else { %>
                            <div class="empty-state">
                                <i class="bi bi-check2-circle"></i>
                                <h2>All Clear!</h2>
                                <p class="text-muted">There are no pending partner registrations to review.</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="approved" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-body">
                        <% if (locals.activePartners && activePartners.length > 0) { %>
                            <div class="partner-list">
                                    <% activePartners.forEach(partner => { %>
    <a href="/admin/manage-partners/<%= partner.id %>" class="partner-card-link">
        <div class="partner-card">
            <div class="partner-avatar partner-avatar-active">
                <span><%= partner.name.charAt(0) %></span>
            </div>
            <div class="partner-info">
                <div class="partner-name"><%= partner.name %></div>
                <div class="partner-org text-muted"><%= partner.organization_name %></div>
            </div>
            <div class="partner-card-go">
                <i class="bi bi-chevron-right"></i>
            </div>
        </div>
    </a>
<% }) %>
                            </div>
                        <% } else { %>
                            <div class="empty-state">
                                <i class="bi bi-people"></i>
                                <h2>No Approved Partners</h2>
                                <p class="text-muted">Approved training partners will appear here.</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="rejected" role="tabpanel">
                 <div class="card mt-3">
                    <div class="card-body">
                         <% if (locals.rejectedPartners && rejectedPartners.length > 0) { %>
                            <div class="partner-list">
                                <% rejectedPartners.forEach(partner => { %>
                                    <div class="partner-card">
                                        <div class="partner-avatar partner-avatar-rejected"><span><%= partner.name.charAt(0) %></span></div>
                                        <div class="partner-info">
                                            <div class="partner-name"><%= partner.name %></div>
                                            <div class="partner-org text-muted"><%= partner.organization_name %></div>
                                        </div>
                                    </div>
                                <% }) %>
                            </div>
                        <% } else { %>
                            <div class="empty-state">
                                <i class="bi bi-slash-circle"></i>
                                <h2>No Rejected Partners</h2>
                                <p class="text-muted">Rejected partner applications will appear here.</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div> 

    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/admin.js"></script>
</body>
</html>